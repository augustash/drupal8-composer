!function(c,d){"use strict";Drupal.exoAutocomplete=Drupal.exoAutocomplete||{},Drupal.behaviors.exoAutocomplete={attach:function(e){var t=d.exoAutocomplete;c("input.exo-autocomplete-form").once("attachExoAutocomplete").each(function(){!0===t[c(this).attr("id")].multiple?new Drupal.exoAutocomplete.MultipleWidget(this,t[c(this).attr("id")]):new Drupal.exoAutocomplete.SingleWidget(t[c(this).attr("id")])})}},c.fn.autoGrowInput=function(u){return u=c.extend({maxWidth:1e3,minWidth:0,comfortZone:70},u),this.filter("input:text").each(function(){var i=u.minWidth||c(this).width(),a="",l=c(this),n=c("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:l.css("fontSize"),fontFamily:l.css("fontFamily"),fontWeight:l.css("fontWeight"),letterSpacing:l.css("letterSpacing"),whiteSpace:"nowrap"});n.insertAfter(l),c(this).bind("keyup keydown blur update",function(){if(a!==(a=l.val())){var e=a.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");n.html(e);var t=n.width(),o=t+u.comfortZone>=i?t+u.comfortZone:i;(o<l.width()&&i<=o||i<o&&o<u.maxWidth)&&l.width(o)}})}),this},Drupal.exoAutocomplete.empty={label:"- "+Drupal.t("None")+" -",value:""},Drupal.exoAutocomplete.escapeRegex=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/gi,"\\$&")},Drupal.exoAutocomplete.filter=function(e,t){var o=new RegExp(Drupal.exoAutocomplete.escapeRegex(t),"i");return c.grep(e,function(e){return o.test(e.label||e.value||e)})},Drupal.exoAutocomplete.Widget=function(){},Drupal.exoAutocomplete.Widget.prototype.uri=null,Drupal.exoAutocomplete.Widget.prototype.acceptTerm=function(e){return!0},Drupal.exoAutocomplete.Widget.prototype.init=function(o){if(-1===navigator.appVersion.indexOf("MSIE 6.")){this.id=o.input_id,this.$item=c("#"+this.id),this.uri=o.uri,this.multiple=o.multiple,this.required=o.required,this.limit=o.limit,this.synonyms=void 0!==o.use_synonyms&&o.use_synonyms,this.not_found_message=void 0===o.use_synonyms?Drupal.t("The entity '@term' will be added."):o.not_found_message,this.not_found_message_allow=void 0!==o.not_found_message_allow&&o.not_found_message_allow,this.new_terms=void 0!==o.new_terms&&o.new_terms,this.no_empty_message=void 0===o.no_empty_message?Drupal.t("No terms could be found. Please type in order to add a new term."):o.no_empty_message,this.wrapper='""',void 0===o.delimiter?this.delimiter=!0:this.delimiter=o.delimiter.charCodeAt(0),this.items={};var l=this,e=this.$item.parent(),t=this.$item.parent().parent();t.append(this.$item),e.remove(),e=t;var n=function(e,t){var o=[];for(var i in e)l.acceptTerm(i)&&o.push({label:e[i],value:i});return c.isEmptyObject(o)&&(l.new_terms||l.not_found_message_allow)&&(" "!==t?o.push({label:Drupal.formatString(l.not_found_message,{"@term":t}),value:t,newTerm:!0}):o.push({label:l.no_empty_message,noTerms:!0})),o},u={},r=null;this.source=function(e,i){var a=e.term;if(a in u)i(n(u[a],a));else{a=a||" ",e.synonyms=l.synonyms;var t=Drupal.url(o.uri+"?q="+a);r=c.getJSON(t,e,function(e,t,o){u[a]=e,o===r&&i(n(e,a))})}},this.$item.autocomplete({source:this.source,minLength:o.min_length});var a,i=this.$item,s="object"==typeof this.$item.data("autocomplete")?"item.autocomplete":"ui-autocomplete",p=c('<div class="exo-autocomplete-throbber exo-autocomplete-closed">&nbsp;</div>').insertAfter(i);this.$item.bind("autocompletesearch",function(e,t){p.removeClass("exo-autocomplete-closed"),p.addClass("exo-autocomplete-open")}),this.$item.bind("autocompleteresponse",function(e,t){if(p.addClass("exo-autocomplete-closed"),p.removeClass("exo-autocomplete-open"),!d.exoAutocomplete[this.id].new_terms&&void 0!==t.item&&t.item.newTerm){var o=c(".ui-widget-content");o.css("pointer-events",""),t.content.length||(t.content[0]={label:Drupal.t("No results found"),value:""},o.css("pointer-events","none"))}}),c.ui.autocomplete.prototype._renderItem=function(e,t){if(a=t.label,""!==this.term){var o=Drupal.exoAutocomplete.escapeRegex(this.term),i=new RegExp('()*""'+o+'""|'+o+"()*","gi");a=t.label.replace(i,'<span class="exo-autocomplete-highlight-char">$&</span>')}return c("<li></li>").data(s,t).append("<a>"+a+"</a>").appendTo(e)}}},Drupal.exoAutocomplete.Widget.prototype.generateValues=function(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(e[o]);return t},Drupal.exoAutocomplete.SingleWidget=function(e){this.init(e),this.setup(),this.$item.addClass("exo-autocomplete-form-single")},Drupal.exoAutocomplete.SingleWidget.prototype=new Drupal.exoAutocomplete.Widget,Drupal.exoAutocomplete.SingleWidget.prototype.setup=function(){var e=this.$item,t=e.parent();t.mousedown(function(){t.hasClass("exo-autocomplete-single-open")?e.autocomplete("close"):e.autocomplete("search","")})},Drupal.exoAutocomplete.MultipleWidget=function(e,t){this.init(t),this.setup()},Drupal.exoAutocomplete.MultipleWidget.prototype=new Drupal.exoAutocomplete.Widget,Drupal.exoAutocomplete.MultipleWidget.prototype.items={},Drupal.exoAutocomplete.MultipleWidget.prototype.acceptTerm=function(e){return!(e in this.items)},Drupal.exoAutocomplete.MultipleWidget.Item=function(e,t){if(!0===t.newTerm)t.label=t.value;else if(!0===t.noTerms)return;this.value=t.value,this.element=c('<span class="exo-autocomplete-item">'+t.label+"</span>"),this.widget=e,this.item=t;var o=this;c('<a class="exo-autocomplete-item-delete" href="javascript:void(0)"></a>').appendTo(this.element).mousedown(function(){o.remove(t),o.widget.$item.parents(".exo-autocomplete-container").next().find("input").trigger("change")})},Drupal.exoAutocomplete.MultipleWidget.Item.prototype.remove=function(){this.element.remove();var e=this.widget.valueForm.val(),t=Drupal.exoAutocomplete.escapeRegex(this.item.value),o=new RegExp('()*""'+t+'""()*',"gi");this.widget.valueForm.val(e.replace(o,"")),delete this.widget.items[this.value]},Drupal.exoAutocomplete.MultipleWidget.prototype.setup=function(){var a=this.$item,e=a.parents(".exo-autocomplete-container"),l=e.next().find("input"),n=this.items,u=this;this.valueForm=l,this.orderValues=function(){var o=[];e.find(".exo-autocomplete-item input").each(function(e,t){o[e]=c(t).val()}),l.val('""'+o.join('"" ""')+'""'),l.trigger("change")},e.sortable({update:u.orderValues,containment:"parent",tolerance:"pointer"});var t="object"==typeof this.$item.data("autocomplete")?"autocomplete":"ui-autocomplete";a.data(t)._resizeMenu=function(){},a.show(),l.hide();var o=l.val();for(var i in o=(o=(o=c.trim(o)).substr(2,o.length-4)).split(/"" +""/))if(o.hasOwnProperty(i)){var r=o[i];if(""!==r){var s=null!==r.match(/["][\w|\s|\D|]*["]/gi)?r.substr(1,r.length-2):r,p={label:Drupal.checkPlain(s),value:r};(p=new Drupal.exoAutocomplete.MultipleWidget.Item(u,p)).element.insertBefore(a),n[p.value]=p}}a.addClass("exo-autocomplete-multiple"),e.addClass("exo-autocomplete-multiple"),this.addValue=function(e){var t=new Drupal.exoAutocomplete.MultipleWidget.Item(u,e);t.element.insertBefore(a),n[e.value]=t;var o=" "+u.wrapper+e.value+u.wrapper,i=l.val();l.val(i+o),a.val("")},e.mouseup(function(){a.autocomplete("search",""),a.focus()}),a.bind("autocompleteselect",function(e,t){if(d.exoAutocomplete[this.id].new_terms||!t.item.newTerm)return u.addValue(t.item),a.width(25),!1;c(this).val("")}),a.bind("autocompletechange",function(e,t){a.val("")}),a.blur(function(){a.parent().children(".exo-autocomplete-item").last().removeClass("exo-autocomplete-item-focus")});var m=!1;a.keypress(function(e){var t,o=a.val();if(e.which===u.delimiter&&o.split('"').length-1!=1||13===e.which&&""!==a.val()){if(!d.exoAutocomplete[this.id].new_terms)return void c(this).val("");if(o=o.substr(0,o.length),void 0===u.items[o]&&""!==o){var i={label:o,value:o};u.addValue(i)}if(m=!0,13===e.which)return e.preventDefault(),e.stopPropagation(),!1}8===e.which&&""===o?(t=a.parent().children(".exo-autocomplete-item").last()).hasClass("exo-autocomplete-item-focus")?(o=t.children("input").val(),u.items[o].remove(u.items[o]),a.autocomplete("search","")):t.addClass("exo-autocomplete-item-focus"):(t=a.parent().children(".exo-autocomplete-item").last()).removeClass("exo-autocomplete-item-focus")}),a.autoGrowInput({comfortZone:50,minWidth:10,maxWidth:460}),a.keyup(function(){if(m)return a.autocomplete("search",""),a.val(""),m=!1})}}(jQuery,drupalSettings);