"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(o):i.value}})(e,t,o||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(c,n,s){var i=function(){function i(e,t){var o;return _classCallCheck(this,i),(o=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,e))).defaults={onBuild:function(){},onSelect:function(){}},o.category="all",o.searchQuery="",o.limit=80,o.page=1,o.selected="",o.events={build:new ExoEvent,select:new ExoEvent},o.$element=t,o}return _inherits(i,ExoData),_createClass(i,[{key:"build",value:function(o){var n=this;return new Promise(function(t,e){o=_.extend({},n.defaults,o),_get(_getPrototypeOf(i.prototype),"build",n).call(n,o).then(function(e){null!==e&&(n.event("build").trigger(n),n.callCallback("onBuild"),s.exoIcon.field&&s.exoIcon.field.emptyIcon&&(n.limit-=1)),t(e)},e)})}},{key:"afterBuild",value:function(){this.$categories=this.$element.find(".exo-icon-browser-category-select"),this.$icons=this.$element.find(".exo-icon-browser-icons"),this.$pager=this.$element.find(".exo-icon-browser-pager"),this.$pagerPrev=this.$element.find(".exo-icon-browser-pager-prev"),this.$pagerNext=this.$element.find(".exo-icon-browser-pager-next"),this.$search=this.$element.find(".exo-icon-browser-search-input"),this.$infoPages=this.$element.find(".exo-icon-browser-info-pages"),this.$infoTotal=this.$element.find(".exo-icon-browser-info-total"),this.buildCategories(),this.buildIcons(),this.buildPager(),this.buildSearch()}},{key:"buildCategories",value:function(){var t=this;this.$categories.on("change",function(e){t.category=t.$categories.val().toString(),t.buildIcons()})}},{key:"buildPager",value:function(){var t=this;this.$pagerPrev.once("exo.icon").on("click",function(e){t.$pagerPrev.hasClass("disabled")||(t.page--,t.placeIcons())}),this.$pagerNext.once("exo.icon").on("click",function(e){t.$pagerNext.hasClass("disabled")||(t.page++,t.placeIcons())}),this.togglePager()}},{key:"togglePager",value:function(){1===this.page?this.$pagerPrev.addClass("disabled"):this.$pagerPrev.removeClass("disabled"),this.limit*this.page>this.icons.length?this.$pagerNext.addClass("disabled"):this.$pagerNext.removeClass("disabled")}},{key:"buildSearch",value:function(){var t=this;this.$search.once("exo.icon").focus().on("keyup",function(e){clearTimeout(t.searchTimer),t.searchTimer=setTimeout(function(){t.searchQuery=t.$search.val().toString().toLowerCase(),t.buildIcons()},300)})}},{key:"buildIcons",value:function(){var t=this;this.icons=[],this.get("packages").forEach(function(e){"all"!==t.category&&t.category!==e||(t.icons=t.icons.concat(t.getIconsByPackageId(e)))}),""!==this.searchQuery&&(this.icons=this.icons.filter(function(e){return-1<e.match(/data-icon-id="(.*?)"/)[1].replace(/-/g," ").toLowerCase().indexOf(t.searchQuery)})),this.page=1,this.placeIcons()}},{key:"placeIcons",value:function(){var t,o=this,n=this.limit*this.page,i=n-this.limit,r=0;this.$icons.off().empty(),s.exoIcon.field&&s.exoIcon.field.emptyIcon&&this.$icons.append('<a class="exo-icon-browser-icon empty '+(this.selected?"":" selected")+'">'+s.exoIcon.field.emptyIcon+"</a>"),this.icons.forEach(function(e){i<=r&&r<n&&(t="exo-icon-browser-icon",e.match(/data-icon-id="(.*?)"/)[1]===o.selected&&(t+=" selected"),o.$icons.append('<a class="'+t+'">'+e+"</a>")),r++}),this.$icons.find(".exo-icon-browser-icon").once("exo.icon").on("click",function(e){o.selected=c(e.currentTarget).find(".exo-icon").data("icon-id")||"",o.event("select").trigger(o),o.callCallback("onSelect")}),this.togglePager(),this.buildInfo()}},{key:"buildInfo",value:function(){this.$infoPages.html(this.page+"/"+(Math.floor(this.icons.length/this.limit)+1)),this.$infoTotal.html("("+this.icons.length.toString()+")")}},{key:"getIconsByPackageId",value:function(e){return s.exoIcon.package&&s.exoIcon.package[e]?s.exoIcon.package[e]:null}},{key:"callCallback",value:function(e){var t=this.get(e);if(t)if("string"==typeof t){var o=n.Exo.stringToCallback(t);o&&o.object[o.function](this)}else"function"!=typeof t&&"object"!==_typeof(t)||t(this)}},{key:"setSelected",value:function(e){return this.selected=e,this}},{key:"getSelected",value:function(){return this.selected}},{key:"getSelectedIcon",value:function(){var t=this;return this.icons.find(function(e){return e.match(/data-icon-id="(.*?)"/)[1]===t.selected})||""}}]),i}();n.behaviors.exoIconBrowser={instance:null,attach:function(e){var n=this;if(s.exoIcon&&s.exoIcon.browser){var t=function(t){if(s.exoIcon.browser.hasOwnProperty(t)){var e=c("#exo-icon-browser-"+t).once("exo.icon");if(e.length){var o=s.exoIcon.browser[t];n.instance=new i(t,e),n.instance.build(o).then(function(e){e&&(n.instance.afterBuild(),delete s.exoIcon.browser[t])})}}};for(var o in s.exoIcon.browser)t(o)}}}}(jQuery,Drupal,drupalSettings);